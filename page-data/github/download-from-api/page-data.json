{"componentChunkName":"component---src-templates-documentation-js","path":"/github/download-from-api","result":{"data":{"markdownRemark":{"parent":{"__typename":"File","relativeDirectory":"github","name":"download-from-api"},"html":"<h3>Set environment variable</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># GitHub Personal Access Token</span>\n<span class=\"token assign-left variable\">PAT</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>git repo:read token<span class=\"token operator\">></span>\n<span class=\"token comment\"># Repo Information</span>\n<span class=\"token assign-left variable\">ORG</span><span class=\"token operator\">=</span>mgamble\n<span class=\"token assign-left variable\">REPO</span><span class=\"token operator\">=</span>mlgamble.github.io\n<span class=\"token assign-left variable\">BRANCH</span><span class=\"token operator\">=</span>master\n<span class=\"token assign-left variable\">LOCATION</span><span class=\"token operator\">=</span>assets</code></pre></div>\n<h3>Download assets</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Download the raw files</span>\n<span class=\"token function\">curl</span> -LH <span class=\"token string\">\"Authorization: token <span class=\"token variable\">$PAT</span>\"</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token string\">\"https://api.github.com/repos/<span class=\"token variable\">$ORG</span>/<span class=\"token variable\">$REPO</span>/contents/<span class=\"token variable\">$LOCATION</span>?ref=<span class=\"token variable\">$BRANCH</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span> \n<span class=\"token function\">grep</span> -e <span class=\"token string\">'\"name\"'</span> -e <span class=\"token string\">'\"download_url\"'</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">awk</span> <span class=\"token string\">'{print <span class=\"token variable\">$2</span>}'</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">tr</span> -d <span class=\"token string\">'\",'</span> <span class=\"token operator\">|</span> <span class=\"token function\">paste</span> - - <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">xargs</span> -L1 -P16 <span class=\"token function\">curl</span> -Lo\n\n<span class=\"token comment\"># Find files that reference git LFS and generate a payload for the LFS API</span>\n<span class=\"token function\">grep</span> -l <span class=\"token string\">'version https://git-lfs.github.com/spec/v1'</span> * <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">xargs</span> <span class=\"token function\">grep</span> -vh <span class=\"token string\">'version'</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">tr</span> <span class=\"token string\">':'</span> <span class=\"token string\">' '</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">awk</span> <span class=\"token string\">'{print <span class=\"token variable\">$NF</span>}'</span> <span class=\"token operator\">|</span> <span class=\"token function\">paste</span> - - <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">awk</span> <span class=\"token string\">'{print \"{ <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>oid<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>: <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>\"<span class=\"token variable\">$1</span>\"<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>, <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>size<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>: \"<span class=\"token variable\">$2</span>\" }\"}'</span> <span class=\"token operator\">|</span> <span class=\"token function\">paste</span> -sd <span class=\"token string\">','</span> - <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">awk</span> <span class=\"token string\">'{print \"{ <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>operation<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>: <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>download<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>, <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>ref<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>: <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>'</span><span class=\"token variable\">$BRANCH</span><span class=\"token string\">'<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>, <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>objects<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>: [ \"<span class=\"token variable\">$0</span>\" ] }\" }'</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\npython -m json.tool <span class=\"token operator\">></span> /tmp/git-lfs.payload\n\n<span class=\"token comment\"># Replace LFS stubs with the actual contents</span>\n<span class=\"token function\">curl</span> -XPOST -LH <span class=\"token string\">\"Authorization: token <span class=\"token variable\">$PAT</span>\"</span> -H <span class=\"token string\">'Accept: application/vnd.git-lfs+json'</span> -H <span class=\"token string\">'Content-Type: application/vnd.git-lfs+json'</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token string\">\"https://github.com/<span class=\"token variable\">$ORG</span>/<span class=\"token variable\">$REPO</span>.git/info/lfs/objects/batch\"</span> -d @/tmp/git-lfs.payload <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">grep</span> -e <span class=\"token string\">'\"oid\"'</span> -e <span class=\"token string\">'\"href\"'</span> -e <span class=\"token string\">'\"Authorization\"'</span> <span class=\"token operator\">|</span> <span class=\"token function\">tr</span> -d <span class=\"token string\">'\",'</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">awk</span> <span class=\"token string\">'{print <span class=\"token variable\">$NF</span>}'</span> <span class=\"token operator\">|</span> <span class=\"token function\">paste</span> - - - <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">awk</span> <span class=\"token string\">'{system(\"grep -l \"<span class=\"token variable\">$1</span>\" *\")} {print <span class=\"token variable\">$2</span>\"?token=\"<span class=\"token variable\">$3</span>}'</span> <span class=\"token operator\">|</span> <span class=\"token function\">paste</span> - - <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">xargs</span> -L1 <span class=\"token function\">curl</span> -Lo</code></pre></div>"}},"pageContext":{"slug":"/github/download-from-api"}}}